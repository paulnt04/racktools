Refactor repetitive code and nest if statements to consolidate code